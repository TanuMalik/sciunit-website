<h1>A Brief Introduction to Sciunit</h1>
<p>From time to time, you may find that it is hard to verify or reproduce someone else’s research, even though it is only programs, data, and output. Programs may be built in different ways, may behave differently if not running in the author’s environment, and can accept different arguments at runtime. All these factors contribute to the difficulties of trying out, if not reproducing, others work. How about, starting from your next paper, you publish the article along with a ‘sciunit’ research object to encapsulate all the workflows you plan to demonstrate, allowing your readers and reviewer to try out your work?</p>
<h2 id="doc-Create">Basic concepts</h2>
<h3>Sciunit</h3>
<p>‘Sciunit’ is both the name of the reusable research object we defined and also the name of command-line tool that creates, manages, and shares <em>sciunits</em>.  A sciunit consists of multiple <em>executions</em>.  Each execution refers to an execution of a command under Linux.  The command may be a single binary, may start with the name of a specific virtual machine for managed languages, such as Java, or may be a shell script that contains multiple commands. An execution may also be a series of terminal inputs that capture your interaction with a UNIX shell. In all cases, the execution have its runtime dependencies determined during an <em>auditing</em> phase, saved to a sciunit, and can be <em>repeated</em> later on a different machine without pulling in any dependencies of the execution.</p>
<p>Each execution is assigned an execution id, starting from <code>e1</code>.  In your paper, you describe each workflow you want to discuss and reference it using its corresponding execution id in a sciunit – just like referencing a figure using a numerical figure id.</p>
<h3>Workspace</h3>
<p>The <em>sciunit</em>(1) command-line tool owns the directory <code>~/sciunit</code>.  A workspace for a sciunit is a subdirectory under <code>~/sciunit</code>.  The command</p>
<blockquote>
<p><code>sciunit create Project1</code></p>
</blockquote>
<p>creates and opens an empty sciunit called “Project1,” where <code>~/sciunit/Project1</code> is its workspace.  You can verify these with</p>
<pre class="hljs language-bash"><code>&gt; sciunit show
sciunit: show: sciunit <span class="hljs-string">'Project1'</span> is empty
</code></pre>
<p>You can switch among multiple workspaces with the <code>open</code> command:</p>
<blockquote>
<p><code>sciunit open Project2</code></p>
</blockquote>
<p>You can also load a sciunit into a workspace and then open it.  The following chapters describe more forms of the <code>open</code> command.</p>
<h2 id="doc-Capture">Capturing and testing your program</h2>
<p>Let’s start with a “Hello World” program in a shell script.</p>
<pre class="hljs language-bash"><code>&gt; cat hello.sh
<span class="hljs-meta">#!/bin/sh</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'hello, world'</span>
</code></pre>
<p>We can run this program</p>
<pre class="hljs language-bash"><code>&gt; ./hello.sh
hello, world
</code></pre>
<p>Now let’s try to capture this program with <code>sciunit</code>.  Assume that we just created a new sciunit called “Project1.”  Rerun the program with <code>sciunit exec</code>:</p>
<pre class="hljs language-bash"><code>&gt; sciunit <span class="hljs-built_in">exec</span> ./hello.sh
hello, world
</code></pre>
<p>Now this program, along with its all its dependencies, has been captured as <code>e1</code> in “Project1.”  The “show” command can display the details of the last captured execution:</p>
<pre class="hljs language-bash"><code>&gt; sciunit show
     id: e1
sciunit: Project1
<span class="hljs-built_in">command</span>: ./hello.sh
   size: 2.82 MB
started: 2017-10-10 08:42
</code></pre>
<p>As we claimed, this execution can be repeated on a different machine.  We will do so in the remaining chapters, but before that, we should test it locally:</p>
<pre class="hljs language-bash"><code>&gt; sciunit repeat e1
hello, world
</code></pre>
<p>If you investigate the workspace</p>
<pre class="hljs language-bash"><code>&gt; ls ~/sciunit/Project1/
cde-package  e1.json  sciunit.db  vvpkg.bin  vvpkg.db
</code></pre>
<p>, you will find a directory named “cde-package” and a few other files.  The “cde-package” is a temporary directory that consists of all necessary files for this execution to repeat; for example, you can even find a “libc.so.6” somewhere under this directory.  The rest of the files are the underlying implementation of the conceptual “sciunit.”</p>
<p>Now let’s try a different way to capture an execution – capture as you go:</p>
<pre class="hljs language-bash"><code>&gt; sciunit <span class="hljs-built_in">exec</span> -i
Interactive capturing started; press Ctrl-D to end
&gt;
</code></pre>
<p>Wait, that’s it?  No, you are merely inside a subshell: all the commands you run from now on will be captured.  For example:</p>
<pre class="hljs language-bash"><code>&gt; <span class="hljs-built_in">echo</span> <span class="hljs-string">'hello'</span>
hello
&gt; ./hello.sh
hello, world
</code></pre>
<p>Now press “Ctrl-D”:</p>
<pre class="hljs language-bash"><code>&gt; <span class="hljs-built_in">exit</span>
Interactive capturing ended
</code></pre>
<p>These commands all become execution <code>e2</code>, and you can repeat it as well.</p>
<p>So far, we created two executions within the sciunit.  You can list them with the <code>list</code> command</p>
<pre class="hljs language-bash"><code>&gt; sciunit list
   e1 Oct 10 08:42 ./hello.sh
   e2 Oct 10 11:00
</code></pre>
<p>, or remove one of them with the <code>rm</code> command.  Note that after a removal all the remaining executions retain their current execution ids, and new executions will be assigned ids which are higher than the remaining ones.</p>
<h2 id="doc-Copy">Continue your work on another machine</h2>
<p>While developing your paper, you might want to capture more executions on another machine, testing your sciunit in another environment, or maybe share the sciunit with a coauthor.  Conceptually, you want to copy &amp; paste, remotely.  The easiest way is to use the <code>copy</code> command:</p>
<pre class="hljs language-bash"><code>&gt; sciunit copy
mSLLTj<span class="hljs-comment">#</span>
</code></pre>
<p>Give it a second, and it returns a code.  You can then “paste” the sciunit over the Internet by running</p>
<blockquote>
<p><code>sciunit open mSLLTj#</code></p>
</blockquote>
<p>on the target machine.  The heavy lifting utilizes the <a href="https://file.io">file.io</a> service.  The code is only valid for one day.  Once pasted, the code is gone.</p>
<p>If you investigate the <code>~/sciunit</code> directory on the machine in which you initiated the copy,</p>
<pre class="hljs language-bash"><code>&gt; ls ~/sciunit
Project1  Project1.zip
</code></pre>
<p>you will find a new zip file.  As you can imagine, it is a zipped version of the sciunit “Project1.”  The <code>open</code> command can also open a zipped sciunit. So if you do not want to use <a href="https://file.io">file.io</a>, you can instead use the <code>sciunit copy -n</code> command to generate this file, and deliver the file to some other machine or to someone else.</p>
<h2 id="doc-Publish">Prepare your paper for review</h2>
<p>The zip file mentioned above is the research object you are going to publish along with your paper.  You can manually select and upload such a file on websites that host sharing of research objects, however, if you are using <a href="https://www.hydroshare.org/">HydroShare</a>, maintaining and updating your draft articles can be drastically simplified with the <em>sciunit</em>(1) tool.</p>
<p>Issue the following command to create a new article for the current sciunit:</p>
<blockquote>
<p><code>sciunit push my_new_article --setup hs</code></p>
</blockquote>
<p>“my_new_article” is a codename for your article.  Codenames are useful for maintaining multiple articles you created from the same sciunit, and you should pick a codename that describes an article’s use, such as “debug.”  “hs” is short for “hydroshare” to indicate the service you are talking to.</p>
<p>The above command prompts you for</p>
<pre><code>Please go to the following link and authorize access:

https://www.hydroshare.org/o/authorize/?response_type=code&amp;client_id=vG5R4zZFO6uJZBj3m0DWtUK6Va44jTQ4KoqtaLpn&amp;redirect_uri=https:%2F%2Fsciunit.run%2Fcb&amp;state=RCeAb6zxbEuw6yHQPDpWu26iHQIcan

Paste the authorization code:
</code></pre>
<p>Here we are running OAuth2 flow for HydroShare.  After you have authorized the <em>sciunit</em> tool in a web browser and pasted in the auth code,</p>
<pre><code>Paste the authorization code: AoxTbXnjzTfIa3OP5d5unxImPn0Noc
Logged in as &quot;User &lt;user@email.com&gt;&quot;
Title for the new article: New Article for Project1
new: 8.93MB [00:01, 4.72MB/s]
</code></pre>
<p>input the title for the article and wait for the upload to finish.  Now you can go to <a href="https://www.hydroshare.org/my-resources/">https://www.hydroshare.org/my-resources/</a> to view your new article on HydroShare.  A newly-created article lacks information for publication and is private.</p>
<p>After each successful “push,” the codename involved is recorded for the next</p>
<blockquote>
<p><code>sciunit push</code></p>
</blockquote>
<p>command to pick up.  So after you make a few changes to the current sciunit, such as capturing a new execution, the above command can silently keep your article on HydroShare up-to-date.  However, if you run</p>
<pre class="hljs language-bash"><code>&gt; sciunit push my_new_article --setup hs
Logged <span class="hljs-keyword">in</span> as <span class="hljs-string">"User &lt;user@email.com&gt;"</span>
Create a new version of the article <span class="hljs-string">"New Article for Project1"</span>? [y/N]
</code></pre>
<p>again, you are creating another new article rather than updating the existing one.  If you answer ‘<code>y</code>’, the article will be a new “version” (HydroShare feature) of the existing one; if you answer ‘<code>n</code>’, the new article can have a different title.  In case you accidentally run into this query and cannot answer it, just press “Ctrl-D” to cancel the operation.</p>
